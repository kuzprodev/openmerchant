!function(g){var h="selectbox",f=!1;function s(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}g.extend(s.prototype,{_isOpenSelectbox:function(s){return s?this._getInst(s).isOpen:f},_isDisabledSelectbox:function(s){return s?this._getInst(s).isDisabled:f},_attachSelectbox:function(l,s){if(this._getInst(l))return f;var e,o,c,d,t=g(l),r=this,u=r._newInst(t),p=f,i=(t.find("optgroup"),t.find("option")),b=i.length;function a(){var s,e,t=this.attr("id").split("_")[1];for(s in r._state)s!==t&&r._state.hasOwnProperty(s)&&(e=g("select[sb='"+s+"']")[0])&&r._closeSelectbox(e)}function n(s,e){var a=!(!e||!e.sub),n=!(!e||!e.disabled);s.each(function(s){var e,t=g(this),i=g("<li>");t.is(":selected")&&(o.text(t.text()),p=!0),s===b-1&&i.addClass("last"),t.is(":disabled")||n?(e=g("<span>",{text:t.text()}).addClass(u.settings.classDisabled),a&&e.addClass(u.settings.classSub)):(e=g("<a>",{href:"#"+t.val(),rel:t.val()}).text(t.text()).bind("click.sb",function(s){s&&s.preventDefault&&s.preventDefault();var e=c,t=g(this);e.attr("id").split("_")[1];r._changeSelectbox(l,t.attr("rel"),t.text()),r._closeSelectbox(l)}).bind("mouseover.sb",function(){var s=g(this);s.parent().siblings().find("a").removeClass(u.settings.classFocus),s.addClass(u.settings.classFocus)}).bind("mouseout.sb",function(){g(this).removeClass(u.settings.classFocus)}),a&&e.addClass(u.settings.classSub),t.is(":selected")&&e.addClass(u.settings.classFocus)),e.appendTo(i),i.appendTo(d)})}t.attr("sb",u.uid),g.extend(u.settings,r._defaults,s),r._state[u.uid]=f,t.hide(),e=g("<div>",{id:"sbHolder_"+u.uid,class:u.settings.classHolder,tabindex:t.attr("tabindex")}),o=g("<a>",{id:"sbSelector_"+u.uid,href:"#",class:u.settings.classSelector,click:function(s){s.preventDefault(),a.apply(g(this),[]);var e=g(this).attr("id").split("_")[1];r._state[e]?r._closeSelectbox(l):r._openSelectbox(l)}}),(c=g("<a>",{id:"sbToggle_"+u.uid,href:"#",class:u.settings.classToggle,click:function(s){s.preventDefault(),a.apply(g(this),[]);var e=g(this).attr("id").split("_")[1];r._state[e]?r._closeSelectbox(l):r._openSelectbox(l)}})).appendTo(e),d=g("<ul>",{id:"sbOptions_"+u.uid,class:u.settings.classOptions,css:{display:"none"}}),t.children().each(function(s){var e,t=g(this),i={};t.is("option")?n(t):t.is("optgroup")&&(e=g("<li>"),g("<span>",{text:t.attr("label")}).addClass(u.settings.classGroup).appendTo(e),e.appendTo(d),t.is(":disabled")&&(i.disabled=!0),i.sub=!0,n(t.find("option"),i))}),p||o.text(i.first().text()),g.data(l,h,u),e.data("uid",u.uid).bind("keydown.sb",function(s){var e,t=s.charCode?s.charCode:s.keyCode?s.keyCode:0,i=g(this),a=i.data("uid"),n=i.siblings("select[sb='"+a+"']").data(h),l=i.siblings(["select[sb='",a,"']"].join("")).get(0),o=i.find("ul").find("a."+n.settings.classFocus);switch(t){case 37:case 38:0<o.length&&(g("a",i).removeClass(n.settings.classFocus),0<(e=o.parent().prevAll("li:has(a)").eq(0).find("a")).length&&(e.addClass(n.settings.classFocus).focus(),r._changeSelectbox(l,e.attr("rel"),e.text())));break;case 39:case 40:g("a",i).removeClass(n.settings.classFocus),0<(e=0<o.length?o.parent().nextAll("li:has(a)").eq(0).find("a"):i.find("ul").find("a").eq(0)).length&&(e.addClass(n.settings.classFocus).focus(),r._changeSelectbox(l,e.attr("rel"),e.text()));break;case 13:0<o.length&&r._changeSelectbox(l,o.attr("rel"),o.text()),r._closeSelectbox(l);break;case 9:l&&(n=r._getInst(l))&&n.isOpen&&(0<o.length&&r._changeSelectbox(l,o.attr("rel"),o.text()),r._closeSelectbox(l));var c=parseInt(i.attr("tabindex"),10);s.shiftKey?c--:c++,g("*[tabindex='"+c+"']").focus();break;case 27:r._closeSelectbox(l)}return s.stopPropagation(),!1}).delegate("a","mouseover",function(s){g(this).addClass(u.settings.classFocus)}).delegate("a","mouseout",function(s){g(this).removeClass(u.settings.classFocus)}),o.appendTo(e),d.appendTo(e),e.insertAfter(t),g("html").on("mousedown",function(s){s.stopPropagation(),g("select").selectbox("close")}),g([".",u.settings.classHolder,", .",u.settings.classSelector].join("")).mousedown(function(s){s.stopPropagation()})},_detachSelectbox:function(s){var e=this._getInst(s);if(!e)return f;g("#sbHolder_"+e.uid).remove(),g.data(s,h,null),g(s).show()},_changeSelectbox:function(s,e,t){var i,a=this._getInst(s);a&&(i=this._get(a,"onChange"),g("#sbSelector_"+a.uid).text(t)),e=e.replace(/\'/g,"\\'"),g(s).val(e),a&&i?i.apply(a.input?a.input[0]:null,[e,a]):a&&a.input&&a.input.trigger("change")},_enableSelectbox:function(s){var e=this._getInst(s);if(!e||!e.isDisabled)return f;g("#sbHolder_"+e.uid).removeClass(e.settings.classHolderDisabled),e.isDisabled=f,g.data(s,h,e)},_disableSelectbox:function(s){var e=this._getInst(s);if(!e||e.isDisabled)return f;g("#sbHolder_"+e.uid).addClass(e.settings.classHolderDisabled),e.isDisabled=!0,g.data(s,h,e)},_optionSelectbox:function(s,e,t){var i=this._getInst(s);if(!i)return f;i[e]=t,g.data(s,h,i)},_openSelectbox:function(s){var e,t,i,a,n,l,o,c=this._getInst(s);!c||c.isOpen||c.isDisabled||(e=g("#sbOptions_"+c.uid),t=parseInt(g(window).height(),10),i=g("#sbHolder_"+c.uid).offset(),a=g(window).scrollTop(),n=e.prev().height(),l=t-(i.top-a)-n/2,o=this._get(c,"onOpen"),e.css({top:n+"px",maxHeight:l-n+"px"}),"fade"===c.settings.effect?e.fadeIn(c.settings.speed):e.slideDown(c.settings.speed),g("#sbToggle_"+c.uid).addClass(c.settings.classToggleOpen),this._state[c.uid]=!0,c.isOpen=!0,o&&o.apply(c.input?c.input[0]:null,[c]),g.data(s,h,c))},_closeSelectbox:function(s){var e,t=this._getInst(s);t&&t.isOpen&&(e=this._get(t,"onClose"),"fade"===t.settings.effect?g("#sbOptions_"+t.uid).fadeOut(t.settings.speed):g("#sbOptions_"+t.uid).slideUp(t.settings.speed),g("#sbToggle_"+t.uid).removeClass(t.settings.classToggleOpen),this._state[t.uid]=f,t.isOpen=f,e&&e.apply(t.input?t.input[0]:null,[t]),g.data(s,h,t))},_newInst:function(s){return{id:s[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:s,uid:Math.floor(99999999*Math.random()),isOpen:f,isDisabled:f,settings:{}}},_getInst:function(s){try{return g.data(s,h)}catch(s){throw"Missing instance data for this selectbox"}},_get:function(s,e){return void 0!==s.settings[e]?s.settings[e]:this._defaults[e]}}),g.fn.selectbox=function(s){var e=Array.prototype.slice.call(arguments,1);return"string"==typeof s&&"isDisabled"==s||"option"==s&&2==arguments.length&&"string"==typeof arguments[1]?g.selectbox["_"+s+"Selectbox"].apply(g.selectbox,[this[0]].concat(e)):this.each(function(){"string"==typeof s?g.selectbox["_"+s+"Selectbox"].apply(g.selectbox,[this].concat(e)):g.selectbox._attachSelectbox(this,s)})},g.selectbox=new s,g.selectbox.version="0.2"}(jQuery);